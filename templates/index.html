{% extends 'base.html' %}

{% load static %}
{% load compress %}
{% load cache %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="row pt-3 pr-5 text-right">
  <div class="col-sm-12">
    <p>
      {% if not request.user.is_anonymous %}
        Hello, {{ request.user.email }}! <small><em>Not {{ request.user.email }}? <a href="{% url 'auth0_logout' %}">Log out</a>.</em></small>
      {% else %}
        {% if request.GET.verify_email == 'true' %}
          <strong>Please verify your email address to use the Pensions Database.</strong>
        {% endif %}
        <a href="{% url 'social:begin' 'auth0' %}">Log In</a>
      {% endif %}
    </p>
  </div>
</div>

<div class="sticky-top float-right pt-5 pr-5">
  <div id="year-toggle">
    <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="yearDropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {{ data_years.0 }}
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        {% for year in data_years %}
          <a class="dropdown-item year-dropdown-item" href="#{{ year }}">{{ year }}</a>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<div class="clearfix"></div>

<div class="row">
  <div class="col-lg-8 offset-lg-2">
    <h3>Illinois Public Pensions Database</h3>

    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla gravida tristique arcu eget suscipit. Etiam arcu libero, eleifend eu aliquam in, bibendum et magna. In vel arcu nulla. Vivamus lacinia leo justo, in maximus eros feugiat eu.</p>
  </div>
</div>

{% cache 10000 system_charts %}
<div class="row pt-5 pb-5" id="funding-by-system">
  <div class="col-lg-10 offset-lg-1">
    <h3 class="pl-2 pb-4"><strong>Funding Distribution by Pension System</strong></h3>
  </div>
  <div class="col-lg-5 offset-lg-1">
    <div class="row">
      <div class="col-lg-6">
        <h4 class="chart-title">State System</h4>
        <h4 class="chart-subtitle"><span class="data-year"></span></h4>
      </div>
      <div class="col-lg-6 text-center">
        <small>TOTAL LIABILITY</small><br />
        <h2>$<span id="total-state-liability"></span></h2>
      </div>
    </div>
    <div id="state-container"></div>
  </div>
  <div class="col-lg-5">
    <div class="row">
      <div class="col-lg-6">
        <h4 class="chart-title">County System</h4>
        <h4 class="chart-subtitle"><span class="data-year"></span></h4>
      </div>
      <div class="col-lg-6 text-center">
        <small>TOTAL LIABILITY</small><br />
        <h2>$<span id="total-county-liability"></span></h2>
      </div>
    </div>
    <div id="county-container"></div>
  </div>
  <div class="col-lg-5 offset-lg-1">
    <div class="row">
      <div class="col-lg-6">
        <h4 class="chart-title">Chicago Municipal System</h4>
        <h4 class="chart-subtitle"><span class="data-year"></span></h4>
      </div>
      <div class="col-lg-6 text-center">
        <small>TOTAL LIABILITY</small><br />
        <h2>$<span id="total-chicago-liability"></span></h2>
      </div>
    </div>
    <div id="chicago-container"></div>
  </div>
  <div class="col-lg-5">
    <div class="row">
      <div class="col-lg-6">
        <h4 class="chart-title">Downstate Municipal System</h4>
        <h4 class="chart-subtitle"><span class="data-year"></span></h4>
      </div>
      <div class="col-lg-6 text-center">
        <small>TOTAL LIABILITY</small><br />
        <h2>$<span id="total-downstate-liability"></span></h2>
      </div>
    </div>
    <div id="downstate-container"></div>
  </div>
</div>
{% endcache %}

<div class="row pt-5 pb-5 hidden" id="funding-by-system-no-data">
  <div class="col-lg-10 offset-lg-1">No data :-(</div>
</div>

<div class="row">
  <div class="col-lg-8 offset-lg-2">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc a elit lectus. Integer ac sapien leo. Nulla urna ex, semper mollis dictum a, bibendum at augue. Cras odio diam, gravida efficitur elit non, suscipit dignissim tellus.</p>

    <p>Cras volutpat lectus quis laoreet gravida. Nullam venenatis neque vel pretium efficitur. Mauris accumsan lectus ac eros rutrum, vitae aliquet lorem porta. Duis sit amet neque lectus. Morbi quis nibh est. Sed sed sem non elit venenatis posuere vitae vitae eros. Duis sed elit nec urna ultricies feugiat ac luctus velit. Vestibulum pulvinar malesuada lectus, vitae mattis lacus. Integer ultrices sem quis tortor cursus bibendum. Suspendisse at pretium justo.</p>

    <p>Etiam turpis justo, sodales nec mauris eu, luctus mattis nunc. Vivamus tristique vel purus vel rhoncus. Proin purus justo, aliquet eu tempus eu, eleifend pellentesque sapien. Sed vestibulum gravida vulputate.</p>
  </div>
</div>

<div class="row py-3">
  <div class="col-lg-12 text-center">
    <p><em>Select a fund to explore the present cost of past decisions:</em></p>

    <div id="fund-toggle">
      <div class="dropdown">
        <button class="btn btn-lg btn-secondary dropdown-toggle" type="button" id="fundDropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          {% for fund in pension_funds %}
            <a class="dropdown-item fund-dropdown-item" href="#{{ fund }}">{{ fund }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<div id="fund-detail">
  <div class="row pt-5">
    <div class="col-lg-6 offset-lg-1">
      <div class="row">
        <div class="col-lg-6">
          <h4 class="chart-title">Funding Distribution</h4>
          <h4 class="chart-subtitle"><span class="employer-name"></span> – <span class="employer-data-year"></span></h4>
        </div>
        <div class="col-lg-4 text-center my-auto">
          <small>TOTAL LIABILITY</small><br />
          <h2>$<span id="employer-liability-amount"></span></h2>
        </div>
      </div>
    </div>
  </div>
  <div class="row pt-3 h-100 text-center">
    <div class="col-lg-6 offset-lg-1">
      <div id="fund-container"></div>
    </div>
    <div class="col-lg-4 my-auto">
      <small>FUNDING LEVEL</small><br />
      <h1><span id="funding-level" class="badge badge-danger"></span></h1>
    </div>
  </div>

  <div class="row py-5">
    <div class="col-lg-6 offset-lg-1">
      <h4 class="chart-title">Distribution of Employer Contribution</h4>
      <h4 class="chart-subtitle"><span class="employer-name"></span> – <span class="employer-data-year"></span></h4>
    </div>
    <div class="col-lg-4 text-center my-auto">
      <small>TOTAL EMPLOYER CONTRIBUTION</small><br />
      <h2>$<span id="employer-contribution-amount"></span></h2>
    </div>
  </div>
  <div class="row">
    <div id="amortization-cost" class="col-lg-10 offset-lg-1"></div>
  </div>
</div>

<div class="row pt-5 pb-5 hidden" id="fund-detail-no-data">
  <div class="col-lg-10 offset-lg-1">No data :-(</div>
</div>

<div class="row p-5">
  <div class="col-lg-4 offset-lg-4 text-center">
      <p>
        <a href="https://auth0.com/?utm_source=oss&amp;utm_medium=gp&amp;utm_campaign=oss" target="_blank" alt="Single Sign On &amp; Token Based Authentication - Auth0"><img src="{% static 'img/a0-badge-dark.png' %}" width="150" height="50" /></a>
      </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'lib/highcharts.js' %}"></script>
{% compress js %}
  <script type="module" src="{% static 'js/base.js' %}"></script>
  <script type="module">
    import { PensionsController, ChartHelper } from "js/base"

    var yearData = {{ data_by_year|safe }};
    var selectedYear = 2017;
    var selectedFund = 'Downstate/Suburban Teachers (TRS)';

    var chartHelper = new ChartHelper();
    var controller = new PensionsController(yearData, selectedYear, selectedFund, chartHelper);

    controller.selectYear(selectedYear);
    controller.selectFund(selectedFund);

    $('.year-dropdown-item').click(function () {
      var selectedYear = $(this).text();

      controller.selectYear(selectedYear);
      controller.selectFund(controller.selectedFund);
    });

    $('.fund-dropdown-item').click(function () {
      var selectedFund = $(this).text();

      controller.selectFund(selectedFund);
    });
  </script>
{% endcompress %}
{% endblock %}
