{% extends 'base.html' %}

{% load static %}
{% load compress %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="sticky-top float-right pt-5 pr-5">
  <div id="year-toggle">
    <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="yearDropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {{ data_years.0 }}
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        {% for year in data_years %}
          <a class="dropdown-item" href="#{{ year }}">{{ year }}</a>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<div class="clearfix"></div>

<div class="row pt-3">
  <div class="col-sm-8 offset-sm-2">
    <h3>Illinois Public Pensions Database</h3>

    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla gravida tristique arcu eget suscipit. Etiam arcu libero, eleifend eu aliquam in, bibendum et magna. In vel arcu nulla. Vivamus lacinia leo justo, in maximus eros feugiat eu.</p>

    <div id="aggregate-funding-container"></div>

    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc a elit lectus. Integer ac sapien leo. Nulla urna ex, semper mollis dictum a, bibendum at augue. Cras odio diam, gravida efficitur elit non, suscipit dignissim tellus.</p>

    <p>Cras volutpat lectus quis laoreet gravida. Nullam venenatis neque vel pretium efficitur. Mauris accumsan lectus ac eros rutrum, vitae aliquet lorem porta. Duis sit amet neque lectus. Morbi quis nibh est. Sed sed sem non elit venenatis posuere vitae vitae eros. Duis sed elit nec urna ultricies feugiat ac luctus velit. Vestibulum pulvinar malesuada lectus, vitae mattis lacus. Integer ultrices sem quis tortor cursus bibendum. Suspendisse at pretium justo.</p>

    <div class="bg-dark mb-3" style="height: 33vh;"></div>

    <p>Etiam semper, ex eget egestas auctor, arcu neque lacinia justo, et dapibus elit tellus quis sem. Maecenas facilisis nisi vel velit pulvinar pulvinar. Vivamus id nisl lobortis, euismod augue et, rhoncus libero. Vestibulum porta faucibus aliquam. Donec tempor erat eget mi pellentesque auctor. Phasellus enim lorem, efficitur pulvinar mi sagittis, tempor pharetra magna. Nullam suscipit elementum quam, nec posuere erat feugiat sit amet.</p>

    <p>Etiam turpis justo, sodales nec mauris eu, luctus mattis nunc. Vivamus tristique vel purus vel rhoncus. Proin purus justo, aliquet eu tempus eu, eleifend pellentesque sapien. Sed vestibulum gravida vulputate.</p>
  </div>
</div>

<div class="row py-3">
  <div class="col-sm-12 text-center">
    <p><em>Select a fund to explore the present cost of past decisions:</em></p>

    <div id="fund-toggle">
      <div class="dropdown">
        <button class="btn btn-lg btn-secondary dropdown-toggle" type="button" id="fundDropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          {% for fund in pension_funds %}
            <a class="dropdown-item" href="#{{ year }}">{{ fund }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row pt-3">
  <div class="col-sm-6 offset-sm-1">
    <div id="fund-container"></div>
  </div>
  <div class="col-sm-4 text-center">
    <small>FUNDING LEVEL</small><br />
    <h1><span id="funding-level" class="badge badge-danger"></span></h1>
  </div>
</div>

<div class="row pt-3">
  <div class="col-sm-10 offset-sm-1">
    <div id="amortization-cost"></div>
  </div>
</div>

<div class="row pt-3">
  <div class="col-sm-10 offset-sm-1">
    <div class="bg-dark mb-3" style="height: 33vh;"></div>
  </div>
</div>

<div class="row pt-3">
  <div class="col-sm-6 offset-sm-3 text-center">
      <p>
        {% if not request.user.is_anonymous %}
          Hello, {{ request.user.email }}!<br />
          <small><em>Not {{ request.user.email }}? <a href="{% url 'auth0_logout' %}">Log out</a>.</em></small>
        {% else %}
          {% if request.GET.verify_email == 'true' %}
            <strong>Please verify your email address to use the Pensions Database.</strong>
          {% endif %}
          <a class="btn btn-primary btn-lg btn-success btn-block" href="{% url 'social:begin' 'auth0' %}">Log In</a>
        {% endif %}
      </p>

      <p>
        <a href="https://auth0.com/?utm_source=oss&amp;utm_medium=gp&amp;utm_campaign=oss" target="_blank" alt="Single Sign On &amp; Token Based Authentication - Auth0"><img src="{% static 'img/a0-badge-dark.png' %}" width="150" height="50" /></a>
      </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'lib/highcharts.js' %}"></script>
{% compress js %}
  <script type="module" src="{% static 'js/base.js' %}"></script>
  <script type="module">
    import { DataYearController, ChartHelper } from "js/base"

    var controller = new DataYearController({{ data_by_year|safe }});
    var chartHelper = new ChartHelper();

    var dataYear = {{ data_years.0 }};
    var selectedFund = 'Downstate/Suburban Teachers (TRS)';

    var yearData = controller.selectYear(dataYear);

    chartHelper.makeBarChart(yearData.aggregate_funding);

    $('#fundDropdownMenuButton').text(selectedFund);

    var fundData = controller.selectFund(dataYear, selectedFund);

    chartHelper.makePieChart(fundData.aggregate_funding);
    chartHelper.makeBarChart(fundData.amortization_cost);

    $('#funding-level').text(fundData.funding_level + '%');

    console.log(fundData.funding_level);

    $('.dropdown-item').click(function () {
      var selectedYear = $(this).text();

      $('#dropdownMenuButton').text(selectedYear);

      yearData = controller.selectYear(parseInt(selectedYear));

      $.each(yearData.aggregate_funding, function (i, data) {
        chartHelper.makeBarChart(data);
      });

      var fundData = controller.selectFund(dataYear, selectedFund).aggregate_funding;

      chartHelper.makePieChart(fundData);
    })
  </script>
{% endcompress %}
{% endblock %}
